<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0,user-scalable=0">
	<meta name="author" content="Zane Wesley">
	<meta name="description" content="A tote manager app.">
	<!-- General -->
	<meta name="theme-color" content="#ffffff">
	<meta name="application-name" content="Tote Manager">
  	<link rel="shortcut icon" href="icon.png">
	<link rel="icon" type="image/png" sizes="500x500" href="icon.png">
	<!-- Apple -->
	<meta name="apple-mobile-web-app-title" content="Tote Manager">
	<meta name="apple-mobile-web-app-status-bar-style" content="#ffffff">
    <meta name="apple-mobile-web-app-capable" content="yes">
	<link rel="apple-touch-icon" sizes="500x500" href="icon.png">
	<link rel="mask-icon" href="icon.png" color="#ffffff">
	<!-- External -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;700&display=swap" rel="stylesheet">
	<link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css" integrity="sha384-AYmEC3Yw5cVb3ZcuHtOA93w35dYTsvhLPVnYs9eStHfGJvOvKxVfELGroGkvsg+p" crossorigin="anonymous"/>
	<title>Tote Manager</title>

	<style>
		* {
			box-sizing: border-box;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
		}
		html, body {
			font-family: "Poppins", sans-serif;
		}
		header {
			font-weight: 500;
			font-size: 3em;
		}
		.menu {
			position: fixed;
			left: 0;
			top: 0;
			/*background-color: #8c8c8c;*/
			background: #555555;
			width: 29%;
			height: 100%;
			color: #fff;
			padding: 0 16px;
		}
		.menu h2 {
			padding: 64px 16px 64px 16px;
			font-weight: 500;
		}
		.menu a {
			display: block;
			width: 100%;
			padding: 8px 16px;
			outline: 0;
			text-decoration: none;
			color: #fff;
			font-size: 18px;
			font-weight: 500;
			transition: all 0.3s;
		}
		.menu a:hover {
			background-color: #fff;
			color: #555555;
		}
		.content {
			margin-left: 29%;
			padding: 40px;
		}
		.content h1 {
			font-weight: 500;
			color: #555555;
			padding: 10px;
		}
		.content hr {
			/*width: 50px;*/
    		border: 5px solid #555555;
    		border-radius: 4px;
    		margin: 20px 0;
		}
		.content h3 {
			padding: 10px 0;
		}
		select {
			display: block;
			font-size: 16px;
			font-family: sans-serif;
			font-weight: normal;
			color: #000;
			line-height: 1.3;
			padding: 8px;
			width: 100%;
			max-width: 100%;
			box-sizing: border-box;
			margin: 0;
			border: 1px solid #555555;
			box-shadow: 0 1px 0 1px rgba(0,0,0,.04);
			border-radius: 0px;
			-moz-appearance: none;
			-webkit-appearance: none;
			appearance: none;
			background-color: transparent;
			background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23555555%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E')/*,
			  linear-gradient(to bottom, #ffffff 0%,#e5e5e5 100%)*/;
			background-repeat: no-repeat, repeat;
			background-position: right .7em top 50%, 0 0;
			background-size: .65em auto, 100%;
		}
		select::-ms-expand {
			display: none;
		}
		select:hover {
			border-color: #555555;
		}
		select:focus {
			border-color: #555555;
			/*box-shadow: 0 0 1px 3px rgba(59, 153, 252, .7);
			box-shadow: 0 0 0 3px -moz-mac-focusring;*/
			color: #000;
			outline: none;
		}
		select option {
			font-weight: normal;
			color: #000;
		}
		button {
			font-size: 16px;
			color: #fff;
			line-height: 1.3;
			padding: 8px;
			background-color: #555555;
			border: none;
			outline: none;
		}
		table {
			border-collapse: collapse;
		    border-spacing: 0;
		    width: 100%;
		    display: table;
		    color: #000;
		}
		table tr {
			border-bottom: 1px solid #ddd;
			display: table-row;
			user-select: none;
			-webkit-user-select: none;
		}
		table tr:first-child {
			cursor: initial;
		}
		table th:first-child {
			padding-left: 16px;
		}
		table tr th {
			padding: 8px 8px;
		    display: table-cell;
		    text-align: left;
		    vertical-align: top;
		    font-weight: bold;
		}
		table tr td:first-child {
			padding-left: 16px;
		}
		table tr td {
			padding: 8px 8px;
		    display: table-cell;
		    text-align: left;
		    vertical-align: top;
		}
		.flagged {
			border-left: 10px solid #f44336;
			background-color: rgba(244, 67, 54, 0.1);
		}
		.category, .flag {
			display: none;
		}
		.snackbar {
          visibility: hidden;
          min-width: 250px;
          background-color: #333;
          color: #fff;
          text-align: center;
          border-radius: 2px;
          padding: 16px;
          position: fixed;
          z-index: 5;
          left: 50%;
          bottom: 30px;
          transform: translateX(-50%);
          font-size: 17px;
        }

        .snackbar.show {
          visibility: visible;
          -webkit-animation: fadein 0.5s, fadeout 0.5s 2.5s;
          animation: fadein 0.5s, fadeout 0.5s 2.5s;
        }

        @-webkit-keyframes fadein {
          from {bottom: 0; opacity: 0;} 
          to {bottom: 30px; opacity: 1;}
        }

        @keyframes fadein {
          from {bottom: 0; opacity: 0;}
          to {bottom: 30px; opacity: 1;}
        }

        @-webkit-keyframes fadeout {
          from {bottom: 30px; opacity: 1;} 
          to {bottom: 0; opacity: 0;}
        }

        @keyframes fadeout {
          from {bottom: 30px; opacity: 1;}
          to {bottom: 0; opacity: 0;}
        }
		.wrapper {
			display: flex;
			flex-direction: row;
			justify-content: space-around;
			align-items: center;
		}
		.wrapper select {
			width: 70%;
		}
		button.request {
			background-color: #f44336;
		}
		@media(max-width: 775px) {
			.menu {
				display: none;
				width: 100%;
			}
			.content {
				margin-left: 0;
				padding: 1em;
			}
			.wrapper select {
				width: 45%;
			}
		}
	</style>
</head>
<body>
	<div class="content">
		<header>Tote Manager</header>
		<hr>
		<h1 id="menu-toggle">Bring Down a Tote</h1>
		<div>
			<h3>Numbered Totes</h3>
			<div class="wrapper">
				<select id="numbered">
					<option selected disabled>Choose a Tote</option>
						<option value="Tote 1">Tote 1</option>
						<option value="Tote 2">Tote 2</option>
						<option value="Tote 3">Tote 3</option>
						<option value="Tote 4">Tote 4</option>
						<option value="Tote 5">Tote 5</option>
						<option value="Tote 6">Tote 6</option>
						<option value="Tote 7">Tote 7</option>
						<option value="Tote 8">Tote 8</option>
						<option value="Tote 9">Tote 9</option>
						<option value="Tote 10">Tote 10</option>
						<option value="Tote 11">Tote 11</option>
						<option value="Tote 12">Tote 12</option>
						<option value="Other">Other</option>
				</select>
				<button id="bring-down-numbered">Bring Down</button>
				<button id="request-numbered" class="request">Request</button>
			</div>
			<h3>Themed Totes</h3>
			<div class="wrapper">
				<select id="themed">
					<option selected disabled>Choose a Tote</option>
						<option value="Educational Games">Educational Games</option>
						<option value="Educational Stuff">Educational Stuff</option>
						<option value="Science Kits">Science Kits</option>
						<option value="Stuffed Animals">Stuffed Animals</option>
						<option value="Other">Other</option>
				</select>
				<button id="bring-down-themed">Bring Down</button>
				<button id="request-themed" class="request">Request</button>
			</div>
			<h3>Big Toys</h3>
			<div class="wrapper">
				<select id="big">
					<option selected disabled>Choose a Tote</option>
					<option value="Baby Dolls">Baby Dolls</option>
					<option value="Barbies">Barbies</option>
					<option value="Baby Stuff">Baby Stuff</option>
					<option value="Dress Up 1">Dress Up 1</option>
					<option value="Dress Up 2">Dress Up 2</option>
					<option value="Electric Train">Electric Train</option>
					<option value="Farm Sets">Farm Sets</option>
					<option value="Kitchen">Kitchen</option>
					<option value="Little People">Little People</option>
					<option value="Magic">Magic</option>
					<option value="Marble Run">Marble Run</option>
					<option value="Paw Patrol">Paw Patrol</option>
					<option value="Tents">Tents</option>
					<option value="Tools">Tools</option>
					<option value="Toy Story">Toy Story</option>
					<option value="Vtech Cars">Vtech Cars</option>
					<option value="Wooden Train">Wooden Train</option>
					<option value="Other">Other</option>
				</select>
				<button id="bring-down-big">Bring Down</button>
				<button id="request-big" class="request">Request</button>
			</div>
			<h3>Requested Totes</h3>
			<div>
				<table id="requested">
					<tr>
						<th>Tote</th>
						<th>Contents</th>
						<th>Date</th>
						<th class="category">Category</th>
						<th class="flag">Flagged</th>
					</tr>
					<!--<tr>
						<td>Sample Tote</td>
						<td>Sample Link</td>
						<td>Sample Date</td>
						<td>Sample Category</td>
						<td>False</td>
					</tr>-->
				</table>
			</div>
		</div>
	</div>
	<div class="menu">
		<h2>Menu</h2>
		<div>
			<a href="index">Bring Down Tote</a>
			<a href="log">Tote Log</a>
		</div>
	</div>

	<!-- The core Firebase JS SDK is always required and must be listed first -->
	<script src="https://www.gstatic.com/firebasejs/8.4.2/firebase-app.js"></script>

	<!-- TODO: Add SDKs for Firebase products that you want to use
	     https://firebase.google.com/docs/web/setup#available-libraries -->
	<script src="https://www.gstatic.com/firebasejs/8.4.2/firebase-firestore.js"></script>

	<script>
	  // Your web app's Firebase configuration
	  var firebaseConfig = {
		    apiKey: "AIzaSyCEOzvPnKE5IZ7Pz-Z91dH7ihiu7OnzrMk",
		    authDomain: "backstock-manager.firebaseapp.com",
		    projectId: "backstock-manager",
		    storageBucket: "backstock-manager.appspot.com",
		    messagingSenderId: "800102189398",
		    appId: "1:800102189398:web:3b3e6af5d2866ed76aeef7"
		  };
		  // Initialize Firebase
		  firebase.initializeApp(firebaseConfig);
	</script>

	<script>
		/*function alphaSortSelect(elem) {
			var tmpArr = new Array();
			for(var i=0; i<elem.options.length; i++) {
				tmpArr[i] = new Array();
				tmpArr[i][0] = elem.options[i].value;
			}
			tmpArr.sort();
			while(elem.options.length > 0) {
				elem.options[0] = null;
			}
			for(var i=0; i<tmpArr.length; i++) {
				var op = new Option(tmpArr[i][0], tmpArr[i][1]);
				elem.options[i] = op;
			}
			return;
		}
		alphaSortSelect(document.getElementById("numbered"));
		alphaSortSelect(document.getElementById("themed"));
		alphaSortSelect(document.getElementById("big"));*/

		/*
			Event Listeners
		*/
		document.getElementById('bring-down-numbered').addEventListener('click', function(e) {
			e.preventDefault();
			saveEntree(document.getElementById('numbered').value, 'numbered', false);
			document.getElementById('numbered').value='Choose a Tote';
		});
		document.getElementById('bring-down-themed').addEventListener('click', function(e) {
			e.preventDefault();
			saveEntree(document.getElementById('themed').value, 'themed', false);
			document.getElementById('themed').value='Choose a Tote';
		});
		document.getElementById('bring-down-big').addEventListener('click', function(e) {
			e.preventDefault();
			saveEntree(document.getElementById('big').value, 'big', false);
			document.getElementById('big').value='Choose a Tote';
		});

		document.getElementById('request-numbered').addEventListener('click', function(e) {
			e.preventDefault();
			saveEntree(document.getElementById('numbered').value, 'numbered', true);
			document.getElementById('numbered').value='Choose a Tote';
		});
		document.getElementById('request-themed').addEventListener('click', function(e) {
			e.preventDefault();
			saveEntree(document.getElementById('themed').value, 'themed', true);
			document.getElementById('themed').value='Choose a Tote';
		});
		document.getElementById('request-big').addEventListener('click', function(e) {
			e.preventDefault();
			saveEntree(document.getElementById('big').value, 'big', true);
			document.getElementById('big').value='Choose a Tote';
		});
		document.getElementById('menu-toggle').addEventListener('click', function(e) {
			e.preventDefault();
			document.querySelector('.menu').style.display='block';
		});

		/*
			Database Functions
		*/

		function saveEntree(name, category, flagged) {
		  // Add a new item entry to the Firebase database.
		  	return firebase.firestore().collection('totes').add({
		    name: name,
		    category: category,
		    date: new Date().formatMMDDYYYY(),
		    flagged: flagged
		  }).then(function() {
		  	snackbarMessgae('<i>' + name + '</i> from <i>' + getCategoryText(category) + '</i> is ' + getRequestType(flagged) + '.');
		  }).catch(function(error) {
		    console.error('Error writing new entree to database', error);
		    snackbarMessgae('Error logging <i>' + name + '</i> from <i>' + getCategoryText(category) + '</i> to database.');
		  });
		}

		function removeItem(id) {
			// Remove item entry from the Firebase database.
		  	return firebase.firestore().collection('totes').doc(id).delete().catch(function(error) {
		    	console.error('Error deleting tote from database', error);
			});
		}

		// Loads tote history and listens for upcoming ones.
		function loadItems() {
		  // Create the query to load items and listen for new ones.
		  var query = firebase.firestore().collection('totes').orderBy('date', 'asc');
		  
		  // Start listening to the query.
		  query.onSnapshot(function(snapshot) {
		    snapshot.docChanges().forEach(function(change) {
		      if (change.type === 'removed') {
		        deleteItem(change.doc.id);
		      } else {
		        var item = change.doc.data();
		        deleteItem(change.doc.id);
		        displayItem(change.doc.id, item.name, item.contents, item.date, item.category, item.flagged);
		      }
		    });
		  });
		}

		// Delete an item from the UI.
		function deleteItem(id) {
		  var div = document.getElementById(id);
		  // If an element for that message exists we delete it.
		  if (div) {
		    div.parentNode.removeChild(div);
		  }
		}

		var TABLE_ROW_TEMPLATE =
		    `<td class="name"></td>
		    <td class="contents"></td>
		    <td class="date"></td>
		    <td class="category"></td>
		    <td class="flag"></td>`;

		// Displays an item in the UI.
		function displayItem(id, name, contents, date, category, flagged) {
		  var item = document.createElement('tr');
		  item.innerHTML = TABLE_ROW_TEMPLATE;
		  item.id = id;
		  item.querySelector('.name').innerHTML=name;
		  item.querySelector('.contents').innerHTML=contents;
		  item.querySelector('.date').innerHTML=date;
		  item.querySelector('.category').innerHTML=category;
		  item.querySelector('.flag').innerHTML=flagged;

		  if(flagged) document.getElementById('requested').appendChild(item);

		}

		/*
			Helper Functions
		*/
		Date.prototype.formatMMDDYYYY = function() {
		    return (this.getMonth() + 1) + "/" +  this.getDate() + "/" +  this.getFullYear();
		}
		function getCategoryText(category) {
			var text;
			switch(category) {
				case 'numbered':
					text = 'Numbered Totes';
					break;
				case 'themed':
					text = 'Themed Totes';
					break;
				case 'big':
					text = 'Big Toys';
					break;
			}
			return text;
		}
		function getRequestType(flagged) {
			var request;
			if(flagged == true) {
				request = 'requested';
			} else if(flagged == false) {
				request = 'logged';
			}
			return request;
		}
		function snackbarMessgae(msg) {
            var snackbar = document.createElement("div");
            snackbar.innerHTML=msg;
            snackbar.classList.add('snackbar');
            snackbar.classList.add('show');
            document.body.appendChild(snackbar);
            setTimeout(function(){ 
                snackbar.remove();
            }, 3000);
        }

        loadItems();
	</script>
</body>
</html>
